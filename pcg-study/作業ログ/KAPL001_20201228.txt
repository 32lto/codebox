
[pcg-adman@ip-172-16-10-123 ~]$ #ホスト名変更
[pcg-adman@ip-172-16-10-123 ~]$ sudo hostnamectl set-hostname kapl001.parallelgame.net
[pcg-adman@ip-172-16-10-123 ~]$ 
[pcg-adman@ip-172-16-10-123 ~]$ #ec2-user削除
[pcg-adman@ip-172-16-10-123 ~]$ sudo userdel -r ec2-user
[pcg-adman@ip-172-16-10-123 ~]$ 
[pcg-adman@ip-172-16-10-123 ~]$ 
[pcg-adman@ip-172-16-10-123 ~]$ #DNS名を検証仕様に変更
[pcg-adman@ip-172-16-10-123 ~]$ sudo vim /var/config/aws/dyndns.tmpl
"/var/config/aws/dyndns.tmpl" 18L, 379C▽  {
    "Changes": [{"Action": "UPSERT","ResourceRecordSet": {"Name": "hapl001.parallelgame.net.","ResourceRecords": [{"Value": "{%IP%}"}],"TTL": 60,"Type": "A"}}
    ]
}

~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            6,16All{
    "Changes": [{"Action": "UPSERT","ResourceRecordSet": {"Name": "hapl001.parallelgame.net.","ResourceRecords": [{"Value": "{%IP%}"}],"TTL": 60,"Type": "A"}}
    ]
}

~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            6,16All"/var/config/aws/dyndns.tmpl" 18L, 379C{
    "Changes": [{"Action": "UPSERT","ResourceRecordSet": {"Name": "hapl001.parallelgame.net.","ResourceRecords": [{"Value": "{%IP%}"}],"TTL": 60,"Type": "A"}}
    ]
}

~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            6,16All"/var/config/aws/dyndns.tmpl" 18L, 379C{
    "Changes": [{"Action": "UPSERT","ResourceRecordSet": {"Name": "hapl001.parallelgame.net.","ResourceRecords": [{"Value": "{%IP%}"}],"TTL": 60,"Type": "A"}}
    ]
}

~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            6,16All"/var/config/aws/dyndns.tmpl" 18L, 379C^[  ^[P0+     ^[P0    i -- INSERT --6,16All789201234567apl001.parallelgame.net.",6kapl001.parallelgame.net.",7^[  6,26All::wq"/var/config/aws/dyndns.tmpl" 18L, 379C written
[pcg-adman@ip-172-16-10-123 ~]$ sudo systemctl restart ec2-route53.service
[pcg-adman@ip-172-16-10-123 ~]$ systemctl status ec2-route53.service
● ec2-route53.service
   Loaded: loaded (/usr/lib/systemd/system/ec2-route53.service; enabled; vendor preset: disabled)
   Active: active (running) since Mon 2020-12-28 20:44:34 JST; 67ms ago
 Main PID: 18323 (ec2Setup.sh)
   CGroup: /system.slice/ec2-route53.service
           tq18323 /bin/sh /var/config/aws/ec2Setup.sh
           mq18326 /usr/bin/python2 -s /usr/bin/aws route53 change-resource-record-sets --hosted-zone-id Z05106306OUV1PE3U4Z8 --change-batch file:///var/config/aws/SetDNS.json
[pcg-adman@ip-172-16-10-123 ~]$ 
[pcg-adman@ip-172-16-10-123 ~]$ #vhosts.ini内記載のuWSGIサーバのプライベートIPをKAPL001のIPに変えておく
[pcg-adman@ip-172-16-10-123 ~]$ 
[pcg-adman@ip-172-16-10-123 ~]$ #172.16.10.123
[pcg-adman@ip-172-16-10-123 ~]$ sudo vim /var/www/uwsgi/vhosts.ini
"/var/www/uwsgi/vhosts.ini" 15L, 284C▽  [uwsgi]
http = 172.16.10.238:3031
chdir = /var/www/uwsgi/app
callable = app
uid = uwsgi
gid = uwsgi
wsgi-file = myapp.py
socket = /var/www/uwsgi/sockets/pcg.sock
chmod-socket = 644
reload-mercy = 1
processes = %k
die-on-term = true
py-autoreload = 1
enable-threads = true
threads = 8
~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            3,26All[uwsgi]
http = 172.16.10.238:3031
chdir = /var/www/uwsgi/app
callable = app
uid = uwsgi
gid = uwsgi
wsgi-file = myapp.py
socket = /var/www/uwsgi/sockets/pcg.sock
chmod-socket = 644
reload-mercy = 1
processes = %k
die-on-term = true
py-autoreload = 1
enable-threads = true
threads = 8
~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            3,26All"/var/www/uwsgi/vhosts.ini" 15L, 284C[uwsgi]
http = 172.16.10.238:3031
chdir = /var/www/uwsgi/app
callable = app
uid = uwsgi
gid = uwsgi
wsgi-file = myapp.py
socket = /var/www/uwsgi/sockets/pcg.sock
chmod-socket = 644
reload-mercy = 1
processes = %k
die-on-term = true
py-autoreload = 1
enable-threads = true
threads = 8
~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            3,26All"/var/www/uwsgi/vhosts.ini" 15L, 284C[uwsgi]
http = 172.16.10.238:3031
chdir = /var/www/uwsgi/app
callable = app
uid = uwsgi
gid = uwsgi
wsgi-file = myapp.py
socket = /var/www/uwsgi/sockets/pcg.sock
chmod-socket = 644
reload-mercy = 1
processes = %k
die-on-term = true
py-autoreload = 1
enable-threads = true
threads = 8
~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            ~                                                                                                                                                                                            3,26All"/var/www/uwsgi/vhosts.ini" 15L, 284C^[P0+     i -- INSERT --3,26All254321:30310:303119:303181:303192:3031203:30311^[  2,20All::wq"/var/www/uwsgi/vhosts.ini" 15L, 284C written
[pcg-adman@ip-172-16-10-123 ~]$ 
[pcg-adman@ip-172-16-10-123 ~]$ sudo systemctl restart uwsgi
sudo systemctl status uwsgi
[pcg-adman@ip-172-16-10-123 ~]$ sudo systemctl status uwsgi
● uwsgi.service - uWSGI Emperor
   Loaded: loaded (/etc/systemd/system/uwsgi.service; enabled; vendor preset: disabled)
   Active: active (running) since Mon 2020-12-28 20:44:53 JST; 14ms ago
  Process: 18381 ExecStartPre=/bin/chown -R uwsgi:uwsgi /var/run/uwsgi (code=exited, status=0/SUCCESS)
  Process: 18378 ExecStartPre=/bin/mkdir -p /var/run/uwsgi (code=exited, status=0/SUCCESS)
  Process: 18375 ExecStartPre=/bin/chown -R uwsgi:uwsgi /var/log/uwsgi (code=exited, status=0/SUCCESS)
  Process: 18373 ExecStartPre=/bin/mkdir -p /var/log/uwsgi (code=exited, status=0/SUCCESS)
 Main PID: 18385 (uwsgi)
   Status: "uWSGI is ready"
   CGroup: /system.slice/uwsgi.service
           tq18385 /usr/local/bin/uwsgi --ini /var/www/uwsgi/emperor.ini
           mq18388 /usr/local/bin/uwsgi --ini /var/www/uwsgi/emperor.ini

Dec 28 20:44:53 kapl001.parallelgame.net systemd[1]: Starting uWSGI Emperor...
Dec 28 20:44:53 kapl001.parallelgame.net uwsgi[18385]: [uWSGI] getting INI configuration from /var/www/uwsgi/emperor.ini
Dec 28 20:44:53 kapl001.parallelgame.net systemd[1]: Started uWSGI Emperor.

[pcg-adman@ip-172-16-10-123 ~]$ 
[pcg-adman@ip-172-16-10-123 ~]$ exit
logout
